<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EASY SUGURTA</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --secondary-bg: #f2f2f7;
            --accent-color: #005a92;
            --gray-text: #8e8e93;
            --card-shadow: 0 4px 25px rgba(0,0,0,0.06);
            --card-bg: #ffffff;
        }

        body.dark-mode {
            --bg-color: #000000;
            --text-color: #ffffff;
            --secondary-bg: #1c1c1e;
            --accent-color: #0a84ff;
            --gray-text: #a1a1a6;
            --card-shadow: 0 4px 25px rgba(0,0,0,0.4);
            --card-bg: #1c1c1e;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0; padding: 16px;
            transition: background-color 0.3s, color 0.3s;
        }

        .header { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        
        .logo-container { display: flex; flex-direction: column; line-height: 1; }
        .logo-easy { font-size: 26px; font-weight: 900; color: #004a80; letter-spacing: -1px; }
        .logo-sugurta { font-size: 16px; font-weight: 300; color: var(--gray-text); margin-top: -2px; }

        .lang-switcher { display: flex; gap: 5px; background: var(--secondary-bg); padding: 4px; border-radius: 12px; }
        .lang-btn { 
            border: none; background: transparent; color: var(--text-color); 
            padding: 6px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer;
        }
        .lang-btn.active { background: var(--accent-color); color: #fff; }

        .theme-toggle {
            background: var(--secondary-bg); border: none; border-radius: 50%;
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 18px; color: var(--text-color);
        }

        .card {
            background: var(--card-bg); border-radius: 24px; padding: 24px;
            box-shadow: var(--card-shadow); margin-bottom: 16px;
        }

        .region-toggle { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px; }
        .region-text { font-size: 14px; color: var(--text-color); }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #34c759; }
        input:checked + .slider:before { transform: translateX(24px); }

        h2 { font-size: 24px; font-weight: 700; margin: 0 0 10px 0; }
        .section-title { color: var(--gray-text); font-size: 14px; margin-bottom: 20px; }

        .input-group { background: var(--secondary-bg); border-radius: 16px; padding: 12px 16px; margin-bottom: 12px; }
        .label { font-size: 13px; color: var(--gray-text); display: block; margin-bottom: 4px; }
        select, input { background: transparent; border: none; outline: none; width: 100%; color: var(--text-color); font-size: 17px; }

        .btn-main {
            background: var(--accent-color); color: white; border: none; width: 100%;
            padding: 18px; border-radius: 18px; font-weight: 600; font-size: 17px; cursor: pointer;
        }

        .faq-item { border-bottom: 1px solid var(--secondary-bg); padding: 16px 0; cursor: pointer; }
        .faq-header { display: flex; align-items: center; font-weight: 500; font-size: 16px; }
        .faq-icon { color: var(--gray-text); margin-right: 12px; font-size: 20px; }
        .faq-content { display: none; padding-top: 12px; font-size: 15px; line-height: 1.5; color: var(--gray-text); }
        .faq-content ul { padding-left: 20px; margin: 10px 0; }

        .calc-res { display: block; text-align: left; margin-top: 10px; }
        .price-big { font-size: 28px; font-weight: 800; margin: 8px 0 24px 0; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ Diqqat */
        #modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-box { position: absolute; top:50%; left:50%; transform: translate(-50%, -50%); width: 90%; background: var(--card-bg); border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-header { display: flex; justify-content: space-between; font-weight: bold; font-size: 18px; margin-bottom: 15px; }
        .modal-body { font-size: 14px; line-height: 1.4; margin-bottom: 20px; }
    </style>
</head>
<body id="main-body">

    <div id="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><span id="txt-modal-title">DIQQAT!</span> <span onclick="closeModal()" style="cursor:pointer">‚úï</span></div>
            <div class="modal-body" id="txt-modal-body">
                Sizning e'tiboringizni shunga qaratamizki, transport vositasini boshqarishga ruxsat berilgan shaxslarning soni cheklangan elektron sug'urta polisini (e-polisni) qayta rasmiylashtirishda texnik cheklovlar munosabati bilan, Siz keyinchalik zarurat bo'lganida polisga yangi haydovchilarni kiritish/qo'shishni amalga oshiromaysiz.
            </div>
            <button class="btn-main" onclick="closeModal()" id="txt-modal-btn">Tushunarlu</button>
        </div>
    </div>

    <div class="header">
        <div class="header-top">
            <div class="logo-container">
                <span class="logo-easy">EASY</span>
                <span class="logo-sugurta">sugurta</span>
            </div>
            <button class="theme-toggle" id="theme-btn" onclick="toggleTheme()">üåì</button>
        </div>
        
        <div class="lang-switcher">
            <button class="lang-btn" id="lang-uz" onclick="changeLang('uz')">UZ</button>
            <button class="lang-btn active" id="lang-ru" onclick="changeLang('ru')">RU</button>
            <button class="lang-btn" id="lang-en" onclick="changeLang('en')">EN</button>
        </div>
    </div>

    <div id="screen-form">
        <h2 id="txt-title">–û–°–ê–ì–û</h2>
        <div class="card">
            <div class="region-toggle">
                <span class="region-text" id="txt-region">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –≥.–¢–∞—à–∫–µ–Ω—Ç –∏–ª–∏ –æ–±–ª.</span>
                <label class="switch">
                    <input type="checkbox" id="region-checkbox" checked onchange="updateLivePrice()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="region-toggle">
                <span class="region-text" id="txt-driver-limit">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥–∏—Ç–µ–ª–µ–π: <b id="driver-label">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ</b></span>
                <label class="switch">
                    <input type="checkbox" id="driver-unlimited" onchange="toggleDrivers()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="input-group">
                <span class="label" id="txt-vtype">–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</span>
                <select id="v-type" onchange="updateLivePrice()">
                    <option value="passenger" id="opt-1">–õ–µ–≥–∫–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</option>
                    <option value="truck" id="opt-2">–ì—Ä—É–∑–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</option>
                    <option value="bus" id="opt-3">–ê–≤—Ç–æ–±—É—Å—ã</option>
                    <option value="moto" id="opt-4">–ú–æ—Ç–æ—Ü–∏–∫–ª—ã</option>
                </select>
            </div>

            <div class="input-group">
                <span class="label" id="txt-carnum">–ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã</span>
                <input type="text" id="car-num" placeholder="01 A 777 AA">
            </div>

            <div style="display: flex; gap: 10px;">
                <div class="input-group" style="flex: 1;">
                    <span class="label" id="txt-seria">–°–µ—Ä–∏—è</span>
                    <input type="text" id="seria" placeholder="AAF">
                </div>
                <div class="input-group" style="flex: 2;">
                    <span class="label" id="txt-tpnum">–ù–æ–º–µ—Ä —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç–∞</span>
                    <input type="text" id="tp-num" placeholder="1234567">
                </div>
            </div>
        </div>
    </div>

    <div id="screen-result" class="calc-res">
        <div class="card">
            <h2 id="txt-calc">–†–∞—Å—á–µ—Ç</h2>
            <div class="label" style="margin-top: 20px;" id="txt-cover">–°—É–º–º–∞ –ø–æ–∫—Ä—ã—Ç–∏—è</div>
            <div style="font-size: 22px; font-weight: 700;">80 000 000,00</div>
            
            <div class="label" style="margin-top: 20px;" id="txt-sum">–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</div>
            <div class="price-big" id="final-price-display">192 000,00 —Å—û–º</div>
            
            <button class="btn-main" onclick="sendData()" id="btn-cont">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <h3 style="margin: 24px 0 16px 8px;" id="txt-faq-title">FAQ</h3>
    <div class="card" style="padding: 0 20px; margin-bottom: 40px;">
        <div class="faq-item" onclick="toggleFaq(0)">
            <div class="faq-header"><span class="faq-icon">+</span> <span id="faq-q1">–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ</span></div>
            <div id="faq-0" class="faq-content">
                <ul>
                    <li id="faq-a1-1">–ü–æ –∑–∞–∫–æ–Ω—É –ø–æ–ª–∏—Å –û–°–ê–ì–û —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.</li>
                    <li>–ü–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Ä–µ–¥ –∂–∏–∑–Ω–∏ –∏ –∑–¥–æ—Ä–æ–≤—å—é (52 –º–ª–Ω) –∏ –∏–º—É—â–µ—Å—Ç–≤—É (28 –º–ª–Ω).</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const translations = {
            ru: {
                title: "–û–°–ê–ì–û", region: "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –≥.–¢–∞—à–∫–µ–Ω—Ç –∏–ª–∏ –æ–±–ª.", dr_limit: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥–∏—Ç–µ–ª–µ–π: ",
                lim_text: "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ", unlim_text: "–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π",
                modal_t: "–í–ù–ò–ú–ê–ù–ò–ï!", modal_b: "–û–±—Ä–∞—â–∞–µ–º –≤–∞—à–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–∑–∂–µ –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã.",
                modal_btn: "–ü–æ–Ω—è—Ç–Ω–æ", find: "–ù–∞–π—Ç–∏", faq_title: "FAQ", calc: "–†–∞—Å—á–µ—Ç", cover: "–°—É–º–º–∞ –ø–æ–∫—Ä—ã—Ç–∏—è", sum: "–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã", cont: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
                opt1: "–õ–µ–≥–∫–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏", opt2: "–ì—Ä—É–∑–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏", opt3: "–ê–≤—Ç–æ–±—É—Å—ã", opt4: "–ú–æ—Ç–æ—Ü–∏–∫–ª—ã"
            },
            uz: {
                title: "O'SAGO", region: "Toshkent sh. yoki viloyatida ro'yxatga olingan", dr_limit: "Haydovchilar soni: ",
                lim_text: "Cheklangan", unlim_text: "Cheklanmagan",
                modal_t: "DIQQAT!", modal_b: "Shuni ma'lum qilamizki, haydovchilar soni cheklangan polislarda keyinchalik yangi haydovchilarni qo'shish imkoniyati mavjud emas.",
                modal_btn: "Tushunarlu", find: "Topish", faq_title: "Ko'p beriladigan savollar", calc: "Hisob-kitob", cover: "Qoplama summasi", sum: "To'lov summasi", cont: "Davom etish",
                opt1: "Yengil avtomobillar", opt2: "Yuk avtomobillari", opt3: "Avtobuslar", opt4: "Mototsikllar"
            },
            en: {
                title: "MTPL", region: "Registered in Tashkent city or region", dr_limit: "Number of drivers: ",
                lim_text: "Limited", unlim_text: "Unlimited",
                modal_t: "ATTENTION!", modal_b: "Please note that if you select a limited number of drivers, you will not be able to add new drivers later due to system limitations.",
                modal_btn: "Understood", find: "Find", faq_title: "FAQ", calc: "Calculation", cover: "Coverage", sum: "Total", cont: "Continue",
                opt1: "Passenger cars", opt2: "Trucks", opt3: "Bus", opt4: "Motorcycles"
            }
        };

        let currentLang = 'ru';

        function toggleTheme() { document.getElementById('main-body').classList.toggle('dark-mode'); tg.HapticFeedback.impactOccurred('light'); }

        function changeLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lang-' + lang).classList.add('active');
            const t = translations[lang];
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-region').innerText = t.region;
            document.getElementById('txt-driver-limit').innerHTML = t.dr_limit + `<b id="driver-label">${document.getElementById('driver-unlimited').checked ? t.unlim_text : t.lim_text}</b>`;
            document.getElementById('txt-modal-title').innerText = t.modal_t;
            document.getElementById('txt-modal-body').innerText = t.modal_b;
            document.getElementById('txt-modal-btn').innerText = t.modal_btn;
            document.getElementById('txt-faq-title').innerText = t.faq_title;
            document.getElementById('txt-calc').innerText = t.calc;
            document.getElementById('txt-cover').innerText = t.cover;
            document.getElementById('txt-sum').innerText = t.sum;
            document.getElementById('btn-cont').innerText = t.cont;
            document.getElementById('opt-1').innerText = t.opt1;
            document.getElementById('opt-2').innerText = t.opt2;
            document.getElementById('opt-3').innerText = t.opt3;
            document.getElementById('opt-4').innerText = t.opt4;
            tg.HapticFeedback.selectionChanged();
        }

        function toggleDrivers() {
            const isUnlimited = document.getElementById('driver-unlimited').checked;
            document.getElementById('driver-label').innerText = isUnlimited ? translations[currentLang].unlim_text : translations[currentLang].lim_text;
            if (!isUnlimited) {
                document.getElementById('modal-overlay').style.display = 'block';
            }
            updateLivePrice();
        }

        function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

        function toggleFaq(id) {
            const el = document.getElementById('faq-' + id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        function updateLivePrice() {
            const isTashkent = document.getElementById('region-checkbox').checked;
            const isUnlimited = document.getElementById('driver-unlimited').checked;
            const vehicleType = document.getElementById('v-type').value;
            let priceValue = 0;

            // –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ (Limited)
            if (vehicleType === "passenger") priceValue = isTashkent ? 192000 : 160000;
            else if (vehicleType === "truck") priceValue = isTashkent ? 336000 : 280000;
            else if (vehicleType === "bus") priceValue = isTashkent ? 384000 : 320000;
            else if (vehicleType === "moto") priceValue = isTashkent ? 72000 : 60000;

            // –ï—Å–ª–∏ –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (Unlimited) - —Ü–µ–Ω–∞ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 2
            if (isUnlimited) priceValue = priceValue * 2;

            document.getElementById('final-price-display').innerText = priceValue.toLocaleString('ru-RU') + ",00 —Å—û–º";
            tg.HapticFeedback.selectionChanged();
        }

        function sendData() {
            if(!document.getElementById('car-num').value) return tg.showAlert("Enter car number");
            tg.sendData(JSON.stringify({ car: document.getElementById('car-num').value, price: document.getElementById('final-price-display').innerText }));
            tg.close();
        }

        updateLivePrice();
    </script>
</body>
</html>
